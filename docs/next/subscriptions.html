<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Subscriptions · TypeGraphQL</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="GraphQL can be used to perform reads with queries and writes with mutations."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Subscriptions · TypeGraphQL"/><meta property="og:type" content="website"/><meta property="og:url" content="https://typegraphql.com/index.html"/><meta property="og:description" content="GraphQL can be used to perform reads with queries and writes with mutations."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://typegraphql.com/blog/atom.xml" title="TypeGraphQL Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://typegraphql.com/blog/feed.xml" title="TypeGraphQL Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-117093147-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="TypeGraphQL"/><h2 class="headerTitleWithLogo">TypeGraphQL</h2></a><a href="/versions.html"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/next/introduction.html" target="_self">Docs</a></li><li class=""><a href="/docs/next/examples.html" target="_self">Examples</a></li><li class=""><a href="/docs/next/faq.html" target="_self">FAQ</a></li><li class=""><a href="https://opencollective.com/typegraphql" target="_self">Donate</a></li><li class=""><a href="https://github.com/MichalLytek/type-graphql" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Advanced guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/introduction.html">What &amp; Why</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Beginner guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/next/getting-started.html">Getting started</a></li><li class="navListItem"><a class="navItem" href="/docs/next/types-and-fields.html">Types and Fields</a></li><li class="navListItem"><a class="navItem" href="/docs/next/resolvers.html">Resolvers</a></li><li class="navListItem"><a class="navItem" href="/docs/next/bootstrap.html">Bootstrapping</a></li><li class="navListItem"><a class="navItem" href="/docs/next/esm.html">ECMAScript Modules</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Migration guide</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/migration-guide.html">v1.x -&gt; v2.0</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/scalars.html">Scalars</a></li><li class="navListItem"><a class="navItem" href="/docs/next/enums.html">Enums</a></li><li class="navListItem"><a class="navItem" href="/docs/next/unions.html">Unions</a></li><li class="navListItem"><a class="navItem" href="/docs/next/interfaces.html">Interfaces</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/next/subscriptions.html">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/next/directives.html">Directives</a></li><li class="navListItem"><a class="navItem" href="/docs/next/extensions.html">Extensions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/dependency-injection.html">Dependency injection</a></li><li class="navListItem"><a class="navItem" href="/docs/next/authorization.html">Authorization</a></li><li class="navListItem"><a class="navItem" href="/docs/next/validation.html">Validation</a></li><li class="navListItem"><a class="navItem" href="/docs/next/inheritance.html">Inheritance</a></li><li class="navListItem"><a class="navItem" href="/docs/next/generic-types.html">Generic Types</a></li><li class="navListItem"><a class="navItem" href="/docs/next/middlewares.html">Middleware and guards</a></li><li class="navListItem"><a class="navItem" href="/docs/next/custom-decorators.html">Custom decorators</a></li><li class="navListItem"><a class="navItem" href="/docs/next/complexity.html">Query complexity</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Integrations</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/prisma.html">Prisma</a></li><li class="navListItem"><a class="navItem" href="/docs/next/nestjs.html">NestJS</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Others</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/emit-schema.html">Emitting the schema SDL</a></li><li class="navListItem"><a class="navItem" href="/docs/next/performance.html">Performance</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Recipes</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/browser-usage.html">Browser usage</a></li><li class="navListItem"><a class="navItem" href="/docs/next/aws-lambda.html">AWS Lambda integration</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/MichalLytek/type-graphql/edit/master/docs/subscriptions.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Subscriptions</h1></header><article><div><span><p>GraphQL can be used to perform reads with queries and writes with mutations.
However, oftentimes clients want to get updates pushed to them from the server when data they care about changes.
To support that, GraphQL has a third operation: subscription. TypeGraphQL of course has great support for subscription, using the <a href="https://the-guild.dev/graphql/yoga-server/docs/features/subscriptions"><code>@graphql-yoga/subscriptions</code></a> package created by <a href="https://the-guild.dev/"><code>The Guild</code></a>.</p>
<h2><a class="anchor" aria-hidden="true" id="creating-subscriptions"></a><a href="#creating-subscriptions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating Subscriptions</h2>
<p>Subscription resolvers are similar to <a href="/docs/next/resolvers.html">queries and mutation resolvers</a> but slightly more complicated.</p>
<p>First we create a normal class method as always, but this time annotated with the <code>@Subscription()</code> decorator.</p>
<pre><code class="hljs css language-ts"><span class="token keyword">class</span> <span class="token class-name">SampleResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Subscription</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">newNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Notification <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then we have to provide the topics we wish to subscribe to. This can be a single topic string, an array of topics or a function to dynamically create a topic based on subscription arguments passed to the query. We can also use TypeScript enums for enhanced type safety.</p>
<pre><code class="hljs css language-ts"><span class="token keyword">class</span> <span class="token class-name">SampleResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Subscription</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    topics<span class="token operator">:</span> <span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">,</span> <span class="token comment">// Single topic</span>
    topics<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">,</span> <span class="token string">"ERRORS"</span><span class="token punctuation">]</span> <span class="token comment">// Or topics array</span>
    <span class="token function-variable function">topics</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> args<span class="token punctuation">,</span> context <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">.</span>topic <span class="token comment">// Or dynamic topic function</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">newNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Notification <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We can also provide the <code>filter</code> option to decide which topic events should trigger our subscription.
This function should return a <code>boolean</code> or <code>Promise&lt;boolean&gt;</code> type.</p>
<pre><code class="hljs css language-ts"><span class="token keyword">class</span> <span class="token class-name">SampleResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Subscription</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    topics<span class="token operator">:</span> <span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">,</span>
    <span class="token function-variable function">filter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> payload<span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">.</span>priorities<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>priority<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">newNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Notification <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We can also provide a custom subscription logic which might be useful, e.g. if we want to use the Prisma subscription functionality or something similar.</p>
<p>All we need to do is to use the <code>subscribe</code> option which should be a function that returns an <code>AsyncIterable</code> or a <code>Promise&lt;AsyncIterable&gt;</code>. Example using Prisma 1 subscription feature:</p>
<pre><code class="hljs css language-ts"><span class="token keyword">class</span> <span class="token class-name">SampleResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Subscription</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">subscribe</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> root<span class="token punctuation">,</span> args<span class="token punctuation">,</span> context<span class="token punctuation">,</span> info <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> context<span class="token punctuation">.</span>prisma<span class="token punctuation">.</span>$subscribe<span class="token punctuation">.</span><span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mutation_in<span class="token operator">:</span> <span class="token punctuation">[</span>args<span class="token punctuation">.</span>mutationType<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">newNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Notification <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>Be aware that we can't mix the <code>subscribe</code> option with the <code>topics</code> and <code>filter</code> options. If the filtering is still needed, we can use the <a href="https://the-guild.dev/graphql/yoga-server/docs/features/subscriptions#filter-and-map-values"><code>filter</code> and <code>map</code> helpers</a> from the <code>@graphql-yoga/subscriptions</code> package.</p>
</blockquote>
<p>Now we can implement the subscription resolver. It will receive the payload from a triggered topic of the pubsub system using the <code>@Root()</code> decorator. There, we can transform it to the returned shape.</p>
<pre><code class="hljs css language-ts"><span class="token keyword">class</span> <span class="token class-name">SampleResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Subscription</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    topics<span class="token operator">:</span> <span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">,</span>
    <span class="token function-variable function">filter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> payload<span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">.</span>priorities<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>priority<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">newNotification</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Root</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> notificationPayload<span class="token operator">:</span> NotificationPayload<span class="token punctuation">,</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Args</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> args<span class="token operator">:</span> NewNotificationsArgs<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> Notification <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>notificationPayload<span class="token punctuation">,</span>
      date<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="triggering-subscription-topics"></a><a href="#triggering-subscription-topics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Triggering subscription topics</h2>
<p>Ok, we've created subscriptions, but what is the <code>pubsub</code> system and how do we trigger topics?</p>
<p>They might be triggered from external sources like a database but also in mutations,
e.g. when we modify some resource that clients want to receive notifications about when it changes.</p>
<p>So, let us assume we have this mutation for adding a new comment:</p>
<pre><code class="hljs css language-ts"><span class="token keyword">class</span> <span class="token class-name">SampleResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Mutation</span></span><span class="token punctuation">(</span>returns <span class="token operator">=></span> Boolean<span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">addNewComment</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Arg</span></span><span class="token punctuation">(</span><span class="token string">"comment"</span><span class="token punctuation">)</span> input<span class="token operator">:</span> CommentInput<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> comment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commentsService<span class="token punctuation">.</span><span class="token function">createNew</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commentsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>First, we need to create the <code>PubSub</code> instance. In most cases, we call <code>createPubSub()</code> function from <code>@graphql-yoga/subscriptions</code> package. Optionally, we can define the used topics and payload type using the type argument, e.g.:</p>
<pre><code class="hljs css language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> createPubSub <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@graphql-yoga/subscriptions"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> pubSub <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createPubSub</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span>
  <span class="token constant">NOTIFICATIONS</span><span class="token operator">:</span> <span class="token punctuation">[</span>NotificationPayload<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token constant">DYNAMIC_ID_TOPIC</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> NotificationPayload<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Then, we need to register the <code>PubSub</code> instance in the <code>buildSchema()</code> function options:</p>
<pre><code class="hljs css language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> buildSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"type-graphql"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> pubSub <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./pubsub"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">buildSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resolver<span class="token punctuation">,</span>
  pubSub<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Finally, we can use the created <code>PubSub</code> instance to trigger the topics and send the payload to all topic subscribers:</p>
<pre><code class="hljs css language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> pubSub <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./pubsub"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SampleResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Mutation</span></span><span class="token punctuation">(</span>returns <span class="token operator">=></span> Boolean<span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">addNewComment</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Arg</span></span><span class="token punctuation">(</span><span class="token string">"comment"</span><span class="token punctuation">)</span> input<span class="token operator">:</span> CommentInput<span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">PubSub</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> pubSub<span class="token operator">:</span> PubSubEngine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> comment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commentsService<span class="token punctuation">.</span><span class="token function">createNew</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commentsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Trigger subscriptions topics</span>
    <span class="token keyword">const</span> payload<span class="token operator">:</span> NotificationPayload <span class="token operator">=</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> input<span class="token punctuation">.</span>content <span class="token punctuation">}</span><span class="token punctuation">;</span>
    pubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And that's it! Now all subscriptions attached to the <code>NOTIFICATIONS</code> topic will be triggered when performing the <code>addNewComment</code> mutation.</p>
<h2><a class="anchor" aria-hidden="true" id="topic-with-dynamic-id"></a><a href="#topic-with-dynamic-id" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Topic with dynamic ID</h2>
<p>The idea of this feature is taken from the <code>@graphql-yoga/subscriptions</code> that is used under the hood.
Basically, sometimes you only want to emit and listen for events for a specific entity (e.g. user or product). Dynamic topic ID lets you declare topics scoped to a special identifier, e.g.:</p>
<pre><code class="hljs css language-ts"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Resolver</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">NotificationResolver</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Subscription</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    topics<span class="token operator">:</span> <span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">,</span>
    <span class="token function-variable function">topicId</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> context <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> context<span class="token punctuation">.</span>userId<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">newNotification</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Root</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span><span class="token operator">:</span> NotificationPayload<span class="token punctuation">)</span><span class="token operator">:</span> Notification <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> message<span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then in your mutation or services, you need to pass the topic id as the second parameter:</p>
<pre><code class="hljs css language-ts">pubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> message <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>Be aware that this feature must be supported by the pubsub system of your choice.
If you decide to use something different than <code>createPubSub()</code> from <code>@graphql-yoga/subscriptions</code>, the second argument might be treated as a payload, not dynamic topic id.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="using-a-custom-pubsub-system"></a><a href="#using-a-custom-pubsub-system" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a custom PubSub system</h2>
<p>While TypeGraphQL uses the <code>@graphql-yoga/subscriptions</code> package under the hood to handle subscription, there's no requirement to use that implementation of <code>PubSub</code>.</p>
<p>In fact, you can use any pubsub system you want, not only the <code>graphql-yoga</code> one.
The only requirement is to comply with the exported <code>PubSub</code> interface - having proper <code>.subscribe()</code> and <code>.publish()</code> methods.</p>
<p>This is especially helpful for production usage, where we can't rely on the in-memory event emitter, so that we <a href="https://the-guild.dev/graphql/yoga-server/docs/features/subscriptions#distributed-pubsub-for-production">use distributed pubsub</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="creating-a-subscription-server"></a><a href="#creating-a-subscription-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a Subscription Server</h2>
<p>The <a href="/docs/next/bootstrap.html">bootstrap guide</a> and all the earlier examples used <a href="https://github.com/apollographql/apollo-server"><code>apollo-server</code></a> to create an HTTP endpoint for our GraphQL API.</p>
<p>However, beginning in Apollo Server 3, subscriptions are not supported by the &quot;batteries-included&quot; apollo-server package. To enable subscriptions, you need to follow the guide on their docs page:
<a href="https://www.apollographql.com/docs/apollo-server/data/subscriptions/#enabling-subscriptions">https://www.apollographql.com/docs/apollo-server/data/subscriptions/#enabling-subscriptions</a></p>
<h2><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h2>
<p>See how subscriptions work in a <a href="https://github.com/MichalLytek/type-graphql/tree/master/examples/simple-subscriptions">simple example</a>. You can see there, how simple is setting up GraphQL subscriptions using <code>graphql-yoga</code> package.</p>
<p>For production usage, it's better to use something more scalable like a Redis-based pubsub system - <a href="https://github.com/MichalLytek/type-graphql/tree/master/examples/redis-subscriptions">a working example is also available</a>.
However, to launch this example you need to have a running instance of Redis and you might have to modify the example code to provide your connection parameters.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/next/interfaces.html"><span class="arrow-prev">← </span><span>Interfaces</span></a><a class="docs-next button" href="/docs/next/directives.html"><span>Directives</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#creating-subscriptions">Creating Subscriptions</a></li><li><a href="#triggering-subscription-topics">Triggering subscription topics</a></li><li><a href="#topic-with-dynamic-id">Topic with dynamic ID</a></li><li><a href="#using-a-custom-pubsub-system">Using a custom PubSub system</a></li><li><a href="#creating-a-subscription-server">Creating a Subscription Server</a></li><li><a href="#examples">Examples</a></li></ul></nav></div><footer class="nav-footer" id="footer"><script>
            const html = document.querySelector("html");

            function appendButtonToDOM() {
              const li = document.createElement("li");
              li.classList.add("center-list-item");
              li.innerHTML = '<div class="toggle"><span>🌙</span><input type="checkbox" id="toggle-switch" /><label for="toggle-switch"><span class="screen-reader-text">Toggle Color Scheme</span></label><span>☀️</span></div>';

              const nav = document.querySelector(".nav-site");
              nav.insertBefore(li, document.querySelector(".navSearchWrapper"));

              const btn = document.querySelector("#toggle-switch");
              btn.addEventListener("click", () => {
                toggleColorMode();
              });
            }

            function setInitialColorMode() {
              const btn = document.querySelector("#toggle-switch");
              let currentColorMode = localStorage.getItem("theme");

              // button was never used
              if (currentColorMode === null) {
                // inspects OS preferred color scheme
                if (
                  window.matchMedia &&
                  window.matchMedia("(prefers-color-scheme: dark)").matches
                ) {
                  currentColorMode = "dark";
                } else {
                  currentColorMode = "light";
                }
              }

              if (currentColorMode === "dark") {
                html.classList.add("theme-mode--dark");
                btn.checked = false;
              } else {
                html.classList.add("theme-mode--light");
                btn.checked = true;
              }
            }

            function toggleColorMode() {
              const btn = document.querySelector("#toggle-switch");
              localStorage.setItem("theme", btn.checked ? "light" : "dark");
              html.classList.toggle("theme-mode--dark");
              html.classList.toggle("theme-mode--light");
            }

            appendButtonToDOM();
            setInitialColorMode();
          </script><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="TypeGraphQL" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/introduction.html">Introduction</a><a href="/docs/getting-started.html">Getting Started</a><a href="/docs/scalars.html">Advanced Guides</a><a href="/docs/dependency-injection.html">Features</a><a href="/docs/emit-schema.html">Others</a></div><div><h5>Community</h5><a href="https://github.com/MichalLytek/type-graphql/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3A&quot;Enhancement+%3Anew%3A&quot;" target="_blank">Feature requests and proposals</a><a href="https://github.com/MichalLytek/type-graphql/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3A&quot;Bug+%3Abug%3A&quot;" target="_blank">Issues</a><a href="https://twitter.com/typegraphql" target="_blank">Twitter</a><a href="https://opencollective.com/typegraphql" target="_blank">Open Collective</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/MichalLytek/type-graphql" target="_blank">GitHub</a><a class="github-button" href="https://github.com/MichalLytek/type-graphql" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2024 Michał Lytek</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2cf66434100c0e30ca9ff499830e7b77',
                indexName: 'typegraphql',
                inputSelector: '#search_input_react'
              });
            </script></body></html>